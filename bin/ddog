#!/usr/bin/env python

import sys

try:
    import libddog
except ImportError:
    sys.path.append('.')

# isort: split
import click

from libddog.command_line.dashboards import (CommandLineError, ConsoleWriter,
                                             DashboardManager)


@click.group()
@click.pass_context
def cli(ctx):
    "Datadog dashboard automation cli"
    pass


@click.group()
@click.pass_context
def dash(ctx):
    "Datadog management actions"

    ctx.dash_mgr = DashboardManager(proj_path='.')
    ctx.writer = ConsoleWriter()


@click.command()
@click.pass_context
def list_defs(ctx):
    "List dashboard definitions"

    mgr = ctx.parent.dash_mgr
    writer = ctx.parent.writer

    try:
        mgr.list_definitions()
    except CommandLineError as exc:
        writer.errorln(exc.message)
        sys.exit(2)



cli.add_command(dash)
dash.add_command(list_defs)


if __name__ == '__main__':
    cli()
